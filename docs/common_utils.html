---

title: inpaint_melanoma


keywords: fastai
sidebar: home_sidebar

summary: "Inpaint a skin lesion"
description: "Inpaint a skin lesion"
nb_path: "05_common_utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 05_common_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="crop_image" class="doc_header"><code>crop_image</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L22" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>crop_image</code>(<strong><code>img</code></strong>, <strong><code>d</code></strong>=<em><code>32</code></em>)</p>
</blockquote>
<p>Make dimensions divisible by <code>d</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_params" class="doc_header"><code>get_params</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L38" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_params</code>(<strong><code>opt_over</code></strong>, <strong><code>net</code></strong>, <strong><code>net_input</code></strong>, <strong><code>downsampler</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Returns parameters that we want to optimize over.
Args:
    opt_over: comma separated list, e.g. "net,input" or "net"
    net: network
    net_input: torch.Tensor that stores input <code>z</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_image_grid" class="doc_header"><code>get_image_grid</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L63" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_image_grid</code>(<strong><code>images_np</code></strong>, <strong><code>nrow</code></strong>=<em><code>8</code></em>)</p>
</blockquote>
<p>Creates a grid from a list of images by concatenating them.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_image_grid" class="doc_header"><code>plot_image_grid</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L70" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_image_grid</code>(<strong><code>images_np</code></strong>, <strong><code>nrow</code></strong>=<em><code>8</code></em>, <strong><code>factor</code></strong>=<em><code>1</code></em>, <strong><code>interpolation</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Draws images in a grid</p>
<p>Args:
    images_np: list of images, each image is np.array of size 3xHxW of 1xHxW
    nrow: how many images will be in one row
    factor: size if the plt.figure
    interpolation: interpolation used in plt.imshow</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load" class="doc_header"><code>load</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L97" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load</code>(<strong><code>path</code></strong>)</p>
</blockquote>
<p>Load PIL image.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_image" class="doc_header"><code>get_image</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L102" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_image</code>(<strong><code>path</code></strong>, <strong><code>imsize</code></strong>=<em><code>-1</code></em>)</p>
</blockquote>
<p>Load an image and resize to a cpecific size.
Args:
    path: path to image
    imsize: tuple or scalar with dimensions; -1 for <code>no resize</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fill_noise" class="doc_header"><code>fill_noise</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L125" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fill_noise</code>(<strong><code>x</code></strong>, <strong><code>noise_type</code></strong>)</p>
</blockquote>
<p>Fills tensor <code>x</code> with noise of type <code>noise_type</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_noise" class="doc_header"><code>get_noise</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L134" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_noise</code>(<strong><code>input_depth</code></strong>, <strong><code>method</code></strong>, <strong><code>spatial_size</code></strong>, <strong><code>noise_type</code></strong>=<em><code>'u'</code></em>, <strong><code>var</code></strong>=<em><code>0.1</code></em>)</p>
</blockquote>
<p>Returns a pytorch.Tensor of size (1 x <code>input_depth</code> x <code>spatial_size[0]</code> x <code>spatial_size[1]</code>)
initialized in a specific way.
Args:
    input_depth: number of channels in the tensor
    method: <code>noise</code> for fillting tensor with noise; <code>meshgrid</code> for np.meshgrid
    spatial_size: spatial size of the tensor to initialize
    noise_type: 'u' for uniform; 'n' for normal
    var: a factor, a noise will be multiplicated by. Basically it is standard deviation scaler.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_noise2" class="doc_header"><code>get_noise2</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L162" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_noise2</code>(<strong><code>input_depth</code></strong>, <strong><code>method</code></strong>, <strong><code>spatial_size</code></strong>, <strong><code>noise_type</code></strong>=<em><code>'u'</code></em>, <strong><code>var</code></strong>=<em><code>0.1</code></em>)</p>
</blockquote>
<p>Returns a pytorch.Tensor of size (1 x <code>input_depth</code> x <code>spatial_size[0]</code> x <code>spatial_size[1]</code>)
initialized in a specific way.
Args:
    input_depth: number of channels in the tensor
    method: <code>noise</code> for fillting tensor with noise; <code>meshgrid</code> for np.meshgrid
    spatial_size: spatial size of the tensor to initialize
    noise_type: 'u' for uniform; 'n' for normal
    var: a factor, a noise will be multiplicated by. Basically it is standard deviation scaler.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pil_to_np" class="doc_header"><code>pil_to_np</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L193" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pil_to_np</code>(<strong><code>img_PIL</code></strong>)</p>
</blockquote>
<p>Converts image in PIL format to np.array.</p>
<p>From W x H x C [0...255] to C x W x H [0..1]</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="np_to_pil" class="doc_header"><code>np_to_pil</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L207" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>np_to_pil</code>(<strong><code>img_np</code></strong>)</p>
</blockquote>
<p>Converts image in np.array format to PIL image.</p>
<p>From C x W x H [0..1] to  W x H x C [0...255]</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="np_to_torch" class="doc_header"><code>np_to_torch</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L221" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>np_to_torch</code>(<strong><code>img_np</code></strong>)</p>
</blockquote>
<p>Converts image in numpy.array to torch.Tensor.
From C x W x H [0..1] to  C x W x H [0..1]</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="torch_to_np" class="doc_header"><code>torch_to_np</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L227" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>torch_to_np</code>(<strong><code>img_var</code></strong>)</p>
</blockquote>
<p>Converts an image in torch.Tensor format to np.array.
From 1 x C x W x H [0..1] to  C x W x H [0..1]</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="optimize" class="doc_header"><code>optimize</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L234" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>optimize</code>(<strong><code>optimizer_type</code></strong>, <strong><code>parameters</code></strong>, <strong><code>closure</code></strong>, <strong><code>LR</code></strong>, <strong><code>num_iter</code></strong>, <strong><code>show_every</code></strong>)</p>
</blockquote>
<p>Runs optimization loop.
Args:
    optimizer_type: 'LBFGS' of 'adam'
    parameters: list of Tensors to optimize over
    closure: function, that returns loss variable
    LR: learning rate
    num_iter: number of iterations</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_for_gif" class="doc_header"><code>plot_for_gif</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L282" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_for_gif</code>(<strong><code>image_to_save</code></strong>, <strong><code>num_iter</code></strong>, <strong><code>i</code></strong>, <strong><code>path_img_dest</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="adjust_learning_rate" class="doc_header"><code>adjust_learning_rate</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L301" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>adjust_learning_rate</code>(<strong><code>optimizer</code></strong>, <strong><code>epoch</code></strong>, <strong><code>LR</code></strong>)</p>
</blockquote>
<p>Sets the learning rate to the initial LR decayed by 10 every X epochs</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="optimize_melanoma_v1" class="doc_header"><code>optimize_melanoma_v1</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/common_utils.py#L310" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>optimize_melanoma_v1</code>(<strong><code>optimizer_type</code></strong>, <strong><code>parameters</code></strong>, <strong><code>closure</code></strong>, <strong><code>LR</code></strong>, <strong><code>num_iter</code></strong>, <strong><code>show_every</code></strong>, <strong><code>path_img_dest</code></strong>, <strong><code>restart</code></strong>=<em><code>True</code></em>, <strong><code>annealing</code></strong>=<em><code>False</code></em>, <strong><code>lr_finder_flag</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>It comes from optimize_v18 we changed the stop training criterion from 0.0005</p>
<h1 id="We-stop-training-when-loss-reaches-0.0005.-We-saw-some-examples-that-looked-ok">We stop training when loss reaches 0.0005. We saw some examples that looked ok<a class="anchor-link" href="#We-stop-training-when-loss-reaches-0.0005.-We-saw-some-examples-that-looked-ok"> </a></h1><p>Runs optimization loop.
Args:
    optimizer_type: 'LBFGS' of 'adam'
    parameters: list of Tensors to optimize over
    closure: function, that returns loss variable
    LR: learning rate
    num_iter: number of iterations</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

