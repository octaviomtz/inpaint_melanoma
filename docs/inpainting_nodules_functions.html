---

title: inpaint_melanoma


keywords: fastai
sidebar: home_sidebar

summary: "Inpaint a skin lesion"
description: "Inpaint a skin lesion"
nb_path: "06_inpainting_nodules_functions.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 06_inpainting_nodules_functions.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="set_all_rcParams" class="doc_header"><code>set_all_rcParams</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L27" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>set_all_rcParams</code>(<strong><code>true_or_false</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_for_gif" class="doc_header"><code>plot_for_gif</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L33" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_for_gif</code>(<strong><code>image_to_save</code></strong>, <strong><code>num_iter</code></strong>, <strong><code>i</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_original" class="doc_header"><code>save_original</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L52" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_original</code>(<strong><code>image_to_save</code></strong>, <strong><code>id_name</code></strong>, <strong><code>name_extension</code></strong>, <strong><code>error_final</code></strong>=<em><code>-1</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_3d" class="doc_header"><code>plot_3d</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L74" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_3d</code>(<strong><code>image</code></strong>, <strong><code>threshold</code></strong>=<em><code>-300</code></em>, <strong><code>alpha</code></strong>=<em><code>0.7</code></em>, <strong><code>fig_size</code></strong>=<em><code>10</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_3d_2" class="doc_header"><code>plot_3d_2</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L97" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_3d_2</code>(<strong><code>image</code></strong>, <strong><code>image2</code></strong>, <strong><code>threshold</code></strong>=<em><code>-300</code></em>, <strong><code>threshold2</code></strong>=<em><code>-300</code></em>, <strong><code>alpha</code></strong>=<em><code>0.7</code></em>, <strong><code>fig_size</code></strong>=<em><code>10</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_slices" class="doc_header"><code>read_slices</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L133" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_slices</code>(<strong><code>new_name</code></strong>)</p>
</blockquote>
<p>Read slices of lung, mask outside lungs and nodule, mask nodule, mask outside</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="make3d_from_sparse" class="doc_header"><code>make3d_from_sparse</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L146" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make3d_from_sparse</code>(<strong><code>path</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="make_images_right_size3D" class="doc_header"><code>make_images_right_size3D</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L158" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make_images_right_size3D</code>(<strong><code>lungs_slice</code></strong>, <strong><code>mask_slice</code></strong>, <strong><code>mask_maxvol_and_lungs_small</code></strong>, <strong><code>outside_lungs</code></strong>)</p>
</blockquote>
<p>Make the images the right size
The encoder-decoder has five blocks (the one initially evalluated),
therefore, each side has to be divisible by a factor of 32 (2^5)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_slices3D" class="doc_header"><code>read_slices3D</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L189" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_slices3D</code>(<strong><code>path_data</code></strong>, <strong><code>ii_ids</code></strong>)</p>
</blockquote>
<p>Read VOLUMES of lung, mask outside lungs and nodule, mask nodule, mask outside</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_slices3D_v2" class="doc_header"><code>read_slices3D_v2</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L220" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_slices3D_v2</code>(<strong><code>path_data</code></strong>, <strong><code>ii_ids</code></strong>)</p>
</blockquote>
<p>Read VOLUMES of lung, mask outside lungs and nodule, mask nodule, mask outside</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_slices3D_v3" class="doc_header"><code>read_slices3D_v3</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L252" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_slices3D_v3</code>(<strong><code>path_data</code></strong>, <strong><code>ii_ids</code></strong>)</p>
</blockquote>
<p>Read VOLUMES of lung, mask outside lungs and nodule, mask nodule, mask outside</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="erode_and_split_mask" class="doc_header"><code>erode_and_split_mask</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L284" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>erode_and_split_mask</code>(<strong><code>mask_lungs</code></strong>, <strong><code>slice_middle</code></strong>)</p>
</blockquote>
<p>We return the center of each lung (from the middle slice). We erode the center slice of the
lungs mask to have the lungs separated</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="box_coords_contain_masks_right_size" class="doc_header"><code>box_coords_contain_masks_right_size</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L313" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>box_coords_contain_masks_right_size</code>(<strong><code>coord_max_sideX</code></strong>, <strong><code>coord_min_sideX</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="box_coords_contain_masks_right_size_search" class="doc_header"><code>box_coords_contain_masks_right_size_search</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L366" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>box_coords_contain_masks_right_size_search</code>(<strong><code>coord_max_sideX</code></strong>, <strong><code>coord_min_sideX</code></strong>, <strong><code>side</code></strong>, <strong><code>slice_middle</code></strong>, <strong><code>xmed_1</code></strong>, <strong><code>ymed_1</code></strong>, <strong><code>xmed_2</code></strong>, <strong><code>ymed_2</code></strong>, <strong><code>mask_lungs_small</code></strong>, <strong><code>dist1</code></strong>=<em><code>96</code></em>, <strong><code>dist2</code></strong>=<em><code>160</code></em>, <strong><code>dist3</code></strong>=<em><code>96</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="box_coords_contain_masks_right_size_search_v2" class="doc_header"><code>box_coords_contain_masks_right_size_search_v2</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L463" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>box_coords_contain_masks_right_size_search_v2</code>(<strong><code>coord_max_sideX</code></strong>, <strong><code>coord_min_sideX</code></strong>, <strong><code>side</code></strong>, <strong><code>slice_middle</code></strong>, <strong><code>xmed_1</code></strong>, <strong><code>ymed_1</code></strong>, <strong><code>xmed_2</code></strong>, <strong><code>ymed_2</code></strong>, <strong><code>mask_lungs_small</code></strong>, <strong><code>version</code></strong>, <strong><code>dist1</code></strong>=<em><code>96</code></em>, <strong><code>dist2</code></strong>=<em><code>160</code></em>, <strong><code>dist3</code></strong>=<em><code>96</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nodule_right_or_left_lung" class="doc_header"><code>nodule_right_or_left_lung</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L568" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nodule_right_or_left_lung</code>(<strong><code>mask_maxvol_smallX</code></strong>, <strong><code>slice_middle</code></strong>, <strong><code>xmed_1</code></strong>, <strong><code>ymed_1</code></strong>, <strong><code>xmed_2</code></strong>, <strong><code>ymed_2</code></strong>)</p>
</blockquote>
<p>For each nodule determine if its closer to the right or left cube center.
Then return, for each side, the min and max coordianates of each nodule</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="my_reset" class="doc_header"><code>my_reset</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L601" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>my_reset</code>(<strong>*<code>varnames</code></strong>)</p>
</blockquote>
<p>varnames are what you want to keep</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_block_if_ndl" class="doc_header"><code>get_block_if_ndl</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L612" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_block_if_ndl</code>(<strong><code>block1</code></strong>, <strong><code>block2</code></strong>, <strong><code>block1_mask</code></strong>, <strong><code>block2_mask</code></strong>, <strong><code>block1_mask_maxvol_and_lungs</code></strong>, <strong><code>block2_mask_maxvol_and_lungs</code></strong>, <strong><code>block1_mask_lungs</code></strong>, <strong><code>block2_mask_lungs</code></strong>)</p>
</blockquote>
<p>If there are nodules in both blocks put them in a list to be processed on be one in a loop.
Also include their mask and their names for identification</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_four_blocks" class="doc_header"><code>get_four_blocks</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L640" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_four_blocks</code>(<strong><code>vol_small</code></strong>, <strong><code>mask_maxvol_small</code></strong>, <strong><code>mask_maxvol_and_lungs_small</code></strong>, <strong><code>mask_lungs_small</code></strong>, <strong><code>c_zmin</code></strong>, <strong><code>c_zmax</code></strong>, <strong><code>c_xmin</code></strong>, <strong><code>c_xmax</code></strong>, <strong><code>c_ymin</code></strong>, <strong><code>c_ymax</code></strong>)</p>
</blockquote>
<p>Based on the limits found in "box_coords_contain_masks_right_size_search"
get the block for the lung scan, the block for the mask with the maxvol segmentation,
the block for the mask with the maxvol segmentation and the lungs and the block
for the mask with the mask of the lungs</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="one_cycle_lr" class="doc_header"><code>one_cycle_lr</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L651" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>one_cycle_lr</code>(<strong><code>mse_error_lr</code></strong>, <strong><code>epochs</code></strong>, <strong><code>LRs</code></strong>, <strong><code>main_peak_ratio</code></strong>=<em><code>0.8</code></em>)</p>
</blockquote>
<p>Find the LR values to apply one cycle. The function returns the learning rates and momentum
values to be use in one_cycle policy</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="one_cycle_constant_range" class="doc_header"><code>one_cycle_constant_range</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L680" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>one_cycle_constant_range</code>(<strong><code>epochs</code></strong>, <strong><code>main_peak_ratio</code></strong>=<em><code>0.8</code></em>, <strong><code>lr_min</code></strong>=<em><code>0.0010699</code></em>, <strong><code>lr_max</code></strong>=<em><code>0.03047718</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="merged_if_close3" class="doc_header"><code>merged_if_close3</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L697" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>merged_if_close3</code>(<strong><code>cluster_names</code></strong>, <strong><code>c_min</code></strong>, <strong><code>c_max</code></strong>, <strong><code>BLOCK_SIZE</code></strong>=<em><code>[96, 160, 96]</code></em>)</p>
</blockquote>
<p>If two nodules are close remove their names from the original
Variable with all names and merge them in a new variable.
By comparing all nodules twice (A != B and B != A) we make sure that
the min of A is close to the max of B and that
the min of B is close to the max of A.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="new_min_max2" class="doc_header"><code>new_min_max2</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L724" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>new_min_max2</code>(<strong><code>clusters_names</code></strong>, <strong><code>clus_names</code></strong>, <strong><code>mer</code></strong>, <strong><code>coords_min</code></strong>, <strong><code>coords_max</code></strong>)</p>
</blockquote>
<p>Merge the names of the nodules that were close (mer). Find the coords
of those nodules and get their min and max. Merge them and remove their
old single versions</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="merge_nodules_in_clusters" class="doc_header"><code>merge_nodules_in_clusters</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L759" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>merge_nodules_in_clusters</code>(<strong><code>coords_min</code></strong>, <strong><code>coords_max</code></strong>, <strong><code>block_number</code></strong>)</p>
</blockquote>
<p>Merge nodules that are close together iteratively</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="box_coords_contain_masks_right_size_search_v3" class="doc_header"><code>box_coords_contain_masks_right_size_search_v3</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L781" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>box_coords_contain_masks_right_size_search_v3</code>(<strong><code>coord_max_sideX</code></strong>, <strong><code>coord_min_sideX</code></strong>, <strong><code>side</code></strong>, <strong><code>slice_middle</code></strong>, <strong><code>xmed_1</code></strong>, <strong><code>ymed_1</code></strong>, <strong><code>xmed_2</code></strong>, <strong><code>ymed_2</code></strong>, <strong><code>mask_lungs_small</code></strong>, <strong><code>version</code></strong>, <strong><code>dist1</code></strong>=<em><code>96</code></em>, <strong><code>dist2</code></strong>=<em><code>160</code></em>, <strong><code>dist3</code></strong>=<em><code>96</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_box_coords_per_block" class="doc_header"><code>get_box_coords_per_block</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L895" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_box_coords_per_block</code>(<strong><code>coord_min_sideX</code></strong>, <strong><code>coord_max_sideX</code></strong>, <strong><code>block_number</code></strong>, <strong><code>slice_middle</code></strong>, <strong><code>xmed_1</code></strong>, <strong><code>ymed_1</code></strong>, <strong><code>xmed_2</code></strong>, <strong><code>ymed_2</code></strong>, <strong><code>vol_small</code></strong>, <strong><code>mask_maxvol_small</code></strong>, <strong><code>mask_maxvol_and_lungs_small</code></strong>, <strong><code>mask_lungs_small</code></strong>, <strong><code>normalize</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Combines in one function the new (v17v2) "box_coords_contain_masks_right_size_search_v2"
"get_four_blocks" and "normalize_clip_and_mask" and applied them iteratively to the
list of merged nodules.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_block_if_ndl_list" class="doc_header"><code>get_block_if_ndl_list</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L920" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_block_if_ndl_list</code>(<strong><code>block1_list</code></strong>, <strong><code>block2_list</code></strong>, <strong><code>block1_mask_list</code></strong>, <strong><code>block2_mask_list</code></strong>, <strong><code>block1_mask_maxvol_and_lungs_list</code></strong>, <strong><code>block2_mask_maxvol_and_lungs_list</code></strong>, <strong><code>block1_mask_lungs_list</code></strong>, <strong><code>block2_mask_lungs_list</code></strong>, <strong><code>clus_names1</code></strong>, <strong><code>clus_names2</code></strong>, <strong><code>box_coords1</code></strong>, <strong><code>box_coords2</code></strong>)</p>
</blockquote>
<p>If there are nodules in both blocks put them in a list to be processed on be one in a loop.
Also include their mask and their names for identification</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="normalize_clip_and_mask" class="doc_header"><code>normalize_clip_and_mask</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L945" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>normalize_clip_and_mask</code>(<strong><code>block_</code></strong>, <strong><code>block_mask_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pad_if_vol_too_small" class="doc_header"><code>pad_if_vol_too_small</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L951" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pad_if_vol_too_small</code>(<strong><code>vol_small_</code></strong>, <strong><code>mask_maxvol_small_</code></strong>, <strong><code>mask_maxvol_and_lungs_small_</code></strong>, <strong><code>mask_lungs_small_</code></strong>, <strong><code>box_shape</code></strong>=<em><code>[97, 161, 97]</code></em>)</p>
</blockquote>
<p>padd the volumes if they are smaller than the box shape.
This can happen specially for the slices because this happens before we resample across slices</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="box_coords_contain_masks_right_size_search_v3_numba" class="doc_header"><code>box_coords_contain_masks_right_size_search_v3_numba</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L962" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>box_coords_contain_masks_right_size_search_v3_numba</code>(<strong><code>coord_max_sideX</code></strong>, <strong><code>coord_min_sideX</code></strong>, <strong><code>side</code></strong>, <strong><code>slice_middle</code></strong>, <strong><code>xmed_1</code></strong>, <strong><code>ymed_1</code></strong>, <strong><code>xmed_2</code></strong>, <strong><code>ymed_2</code></strong>, <strong><code>mask_lungs_small</code></strong>, <strong><code>version</code></strong>, <strong><code>dist1</code></strong>=<em><code>96</code></em>, <strong><code>dist2</code></strong>=<em><code>160</code></em>, <strong><code>dist3</code></strong>=<em><code>96</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nodules_in_box_loop" class="doc_header"><code>nodules_in_box_loop</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/inpainting_nodules_functions.py#L1010" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nodules_in_box_loop</code>(<strong><code>slice_middle</code></strong>, <strong><code>dist1</code></strong>, <strong><code>dist2</code></strong>, <strong><code>dist3</code></strong>, <strong><code>xmed_X</code></strong>, <strong><code>ymed_X</code></strong>, <strong><code>mask_lungs_small</code></strong>, <strong><code>coord_max_sideX</code></strong>, <strong><code>coords_sideX</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

