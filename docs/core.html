---

title: inpaint_melanoma


keywords: fastai
sidebar: home_sidebar

summary: "Inpaint a skin lesion"
description: "Inpaint a skin lesion"
nb_path: "00_core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="rgb2gray" class="doc_header"><code>rgb2gray</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/core.py#L48" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>rgb2gray</code>(<strong><code>rgb</code></strong>)</p>
</blockquote>
<p><a href="https://stackoverflow.com/questions/12201577/how-can-i-convert-an-rgb-image-into-grayscale-in-python">https://stackoverflow.com/questions/12201577/how-can-i-convert-an-rgb-image-into-grayscale-in-python</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="otsu_thresh_4largest_component" class="doc_header"><code>otsu_thresh_4largest_component</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/core.py#L52" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>otsu_thresh_4largest_component</code>(<strong><code>img2</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="component_closest_center" class="doc_header"><code>component_closest_center</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/core.py#L66" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>component_closest_center</code>(<strong><code>img2</code></strong>, <strong><code>masks_lesions</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_center" class="doc_header"><code>get_center</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/core.py#L80" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_center</code>(<strong><code>img</code></strong>, <strong><code>part</code></strong>=<em><code>0.25</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="denormalizePatches" class="doc_header"><code>denormalizePatches</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/core.py#L91" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>denormalizePatches</code>(<strong><code>img</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="figs_horizontal2" class="doc_header"><code>figs_horizontal2</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/core.py#L97" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>figs_horizontal2</code>(<strong><code>ff</code></strong>, <strong><code>names_selected</code></strong>, <strong><code>suffix_available</code></strong>, <strong><code>path_source</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="figs_comparison" class="doc_header"><code>figs_comparison</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/core.py#L120" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>figs_comparison</code>(<strong><code>ff</code></strong>, <strong><code>names_selected</code></strong>, <strong><code>suffix_available</code></strong>, <strong><code>gen_idx</code></strong>, <strong><code>folder</code></strong>=<em><code>'/mnt/90cf2a10-3cf8-48a6-9234-9973231cadc6/Kaggle/melanoma/datasets_preprocessed/size_512/'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="figs_horizontal3" class="doc_header"><code>figs_horizontal3</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/core.py#L151" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>figs_horizontal3</code>(<strong><code>ff</code></strong>, <strong><code>names_selected</code></strong>, <strong><code>suffix_available</code></strong>, <strong><code>path_results</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_inpaints_pairs" class="doc_header"><code>plot_inpaints_pairs</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/core.py#L168" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_inpaints_pairs</code>(<strong><code>mse_error</code></strong>, <strong><code>images_raw</code></strong>, <strong><code>images_combined</code></strong>, <strong><code>epochs_saved</code></strong>, <strong><code>filename</code></strong>, <strong><code>archi</code></strong>, <strong><code>params</code></strong>, <strong><code>path_save</code></strong>=<em><code>''</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="channels_first_last" class="doc_header"><code>channels_first_last</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/core.py#L207" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>channels_first_last</code>(<strong><code>img</code></strong>, <strong><code>output</code></strong>=<em><code>'first'</code></em>)</p>
</blockquote>
<p>just change an img to channels last or to channels first</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_distributions" class="doc_header"><code>plot_distributions</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/core.py#L218" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_distributions</code>(<strong><code>img</code></strong>, <strong><code>images</code></strong>, <strong><code>mask_var</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_saved_images" class="doc_header"><code>get_saved_images</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/core.py#L239" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_saved_images</code>(<strong><code>path_img_dest</code></strong>, <strong><code>filename</code></strong>, <strong><code>name</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_sample_distributions_per_channel" class="doc_header"><code>get_sample_distributions_per_channel</code><a href="https://github.com/octaviomtz/inpaint_melanoma/tree/master/inpaint_melanoma/core.py#L253" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_sample_distributions_per_channel</code>(<strong><code>img</code></strong>, <strong><code>mask_var</code></strong>, <strong><code>len_lesion</code></strong>)</p>
</blockquote>
<p>For each channel, get a sample distribution of the outside skin
of the same size of the lesion</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;ISIC_0076742&#39;</span>
<span class="c1"># if cloud</span>
<span class="c1"># drive.mount(&#39;/content/gdrive/&#39;)</span>
<span class="c1"># path_source = &#39;/content/gdrive/My Drive/KCL/melanoma/size_512/&#39;</span>
<span class="c1"># path_img_dest = &#39;/content/gdrive/My Drive/KCL/melanoma/results_512/&#39;</span>
<span class="c1"># if local</span>
<span class="n">path_source</span> <span class="o">=</span> <span class="s1">&#39;/mnt/c/Users/octav/Documents/Datasets/melanoma/size_512/&#39;</span>
<span class="n">path_img_dest</span> <span class="o">=</span> <span class="s1">&#39;/mnt/c/Users/octav/Documents/Datasets/melanoma/results_size_512/&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{path_source}{filename}</span><span class="s1">.jpg&#39;</span><span class="p">)</span>
<span class="n">mask_lesion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{path_source}</span><span class="s1">mask_</span><span class="si">{filename}</span><span class="s1">.npz&#39;</span><span class="p">)</span>
<span class="n">mask_lesion</span> <span class="o">=</span> <span class="n">mask_lesion</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">arr_0</span>
<span class="n">mask_inpain</span> <span class="o">=</span> <span class="o">~</span><span class="n">mask_lesion</span>
<span class="c1"># reshape and normalize</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">channels_first_last</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">/</span><span class="mf">255.</span>
<span class="n">mask_inpain</span> <span class="o">=</span> <span class="n">mask_inpain</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;img: {np.shape(img), np.shape(mask_inpain)}&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>img: ((3, 512, 512), (512, 512))
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">run_epochs</span> <span class="o">=</span> <span class="mi">51</span>
<span class="n">channels_input</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">channels_layers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">]</span>
<span class="n">channels_skip</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">channels_layers</span><span class="p">)</span>
<span class="n">channels_layers_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">channels_layers</span><span class="p">]</span>
<span class="n">channels_skip_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">channels_skip</span><span class="p">]</span>
<span class="n">layers_str</span> <span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">channels_layers_str</span><span class="p">)</span>
<span class="n">skip_str</span> <span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">channels_skip_str</span><span class="p">)</span>
<span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{run_epochs}</span><span class="s1">_</span><span class="si">{channels_input}</span><span class="s1">_</span><span class="si">{layers_str}</span><span class="s1">s</span><span class="si">{skip_str}</span><span class="s1">&#39;</span>
<span class="n">name_for_fig</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{channels_input}</span><span class="s1">_</span><span class="si">{layers_str}</span><span class="s1">s</span><span class="si">{skip_str}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lesion_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_inpain</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
<span class="n">lesion_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lesion_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">skin_sample_ch0_np</span><span class="p">,</span> <span class="n">skin_sample_ch1_np</span><span class="p">,</span> <span class="n">skin_sample_ch2_np</span> <span class="o">=</span> <span class="n">get_sample_distributions_per_channel</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">mask_inpain</span><span class="p">,</span> <span class="n">lesion_size</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">skin_sample_ch0_np</span><span class="p">);</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;channel_0&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">skin_sample_ch1_np</span><span class="p">);</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;channel_1&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">skin_sample_ch2_np</span><span class="p">);</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;channel_2&#39;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAswAAADSCAYAAABekpbYAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4xLjMsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+AADFEAAAfeElEQVR4nO3df7RdZX3n8fenRLD+giApg/wwtKAWu0alGcDljMsxNSA6xjVVitOWyMpMurqoOq3TCp3O0AGZBdOuUlxVO1TQ4FIBUy1ZgtIUoY6zChLEUgEZIj8kFEhKQqpS1NDv/LGfiych9+QmOfecc899v9Y66+797Gfv8zzn3mff79n72c+TqkKSJEnSrv3EqAsgSZIkjTMDZkmSJKkPA2ZJkiSpDwNmSZIkqQ8DZkmSJKkPA2ZJkiSpDwNmSZIkqQ8D5gmR5N1JvjrqcuwsySeSfHDU5ZDGie1VmjtsrwIDZo2JJEuTfCvJk0luTPLSUZdJ0rMl2T/JmiQPJKkkbxh1mSTtWpKTkqxLsiXJ5iSfTXLYqMs1Fxkwa+SSHAJ8DvhvwMHAeuCqkRZKUj9fBX4FeHTUBZHU10LgUmAx8FLgu8DHR1mgucqAeQ5KcmSSz7Vvi48n+ZOebX+YZGuS+5O8uSf9zCR3J/lukvuS/FrPtjck2Zjk/Uk2JXkkyZk92z+R5MNJrm3735LkZ3q2v6LnG+w9SU7bwyr9e+DOqvpsVT0F/D7wqiSv2IuPRxork9Zeq+qHVfXHVfVV4Om9/mCkMTSB7fWL7X/rP1bVk8CfAK/b289nPjNgnmOS7Ad8AXiQ7hvj4cCVbfOJwD3AIcD/Ai5LkrZtE/BW4EXAmcDFSY7vOfS/AA5sx1sJfDjJwp7tpwP/g+7b6gbgglae5wPrgE8DP9XyfSTJcXtQrVcCfzu1UlXfB77d0qU5a0LbqzSR5kl7fT1w5z7sP28ZMM89JwAvAX67qr5fVU+1Kz0AD1bVn1XV08Bq4DDgUICquraqvl2dvwb+Evg3Pcf9EXBeVf2oqq4Dvge8vGf756vqa1W1HfgU8OqW/lbggar6eFVtr6rbgT8H3rkHdXoBsG2ntG3AC/fgGNI4msT2Kk2qiW6vSf4l8N+B396b/ee7BaMugPbYkXQNd/sutj3Tn7Cqnmxffl8A0G4fnQu8jO6L0vOAv+vZ9/Gdjvnk1L47H3unbS8FTkzyRM/2BcAn96BO36P7Zt7rRXR9raS5bBLbqzSpJra9JjkG+CLwvqr6P3u6vwyY56KHgKOSLJimUT9LkgPovpWeAVxTVT9K8hdA+u854/L8dVW9aR+OcSewYmql3Yb6GbxtpLlvEturNKkmsr2mG3Xqr4Dzq8ovx3vJLhlzz9eAR4ALkzw/yXOT7K4D//7AAcBmYHv7NrxsQOX5AvCyJL+a5Dnt9a+S/OweHOPzwM8l+cUkz6W7ZXRHVX1rQGWURmUS2ytJDmhtFWD/Vq9BBAjSKE1ce01yOPBl4E+q6k8HVK55yYB5jmn9p/4dcAzwHWAj8Eu72ee7wHuBq4GtwH8A1g6oPN+lOzmcDvw93a2li+hOIDM9xmbgF+kedNhK93DF6YMonzRKk9hem3uAf6J7iOn6tuzY6ZrTJrS9/kfgp4HfT/K9qdcgyjffpKpGXQZJkiRpbHmFWZIkSerDgFlDkeR3e28H9by+OOqySdqR7VWaO2yvw2GXDEmSRiTJy4GrepJ+mu7B5yta+mLgAeC0qtraHq68BDiVbgiyd1fV19uxVgC/147zwapaPYw6SPOBAbMkSWOgzTT3MN2Dz2cBW6rqwiRnAwur6gNJTgXeQxcwnwhcUlUnJjkYWA8sAQq4Dfj5qto6irpIk2asx2E+5JBDavHixaMuhjQ2brvttn+oqkWjLsd0bLPSjvawzS4Fvl1VDyZZDryhpa8GbgI+ACwHrqjuatfNSQ5KcljLu66qtgAkWQecAnxmujezvUo76tdexzpgXrx4MevXrx91MaSxkeTBUZehH9ustKM9bLOn8+MA99CqeqQtP0qbhpluKL+HevbZ2NKmS5+W7VXaUb/26kN/kiSNWJL9gbcBn915W7uaPJD+k0lWJVmfZP3mzZsHcUhpXjBgliRp9N4MfL2qHmvrj7WuFrSfm1r6w8CRPfsd0dKmS99BVV1aVUuqasmiRWPbu0saOwbMkiSN3rvYsb/xWmBFW14BXNOTfkY6JwHbWteN64FlSRYmWUg3Q9z1wym6NPnGug+zJEmTLsnzgTcBv9aTfCFwdZKVwIPAaS39OroRMjbQDSt3JkBVbUlyPnBry3fe1AOAkvadAbMkSSNUVd8HXrxT2uN0o2bsnLfohpzb1XEuBy6fjTJK850Bs+a1xWdfu8/HeODCtwygJJJ2ZxDtFWyz0jBMWnu1D7M0YZL8ZpI7k3wzyWeSPDfJ0UluSbIhyVXtiXySHNDWN7Tti3uOc05LvyfJyaOqjyRJo2bALE2QJIcD7wWWVNXPAfvRje16EXBxVR0DbAVWtl1WAltb+sUtH0mOa/u9km7yg4+0WcgkSZp3DJilybMA+MkkC4DnAY8AbwTWtO2rgbe35eVtnbZ9aZK09Cur6gdVdT/dA0YnDKn8kiSNFQNmaYJU1cPAHwLfoQuUtwG3AU9U1faWrXcGsGdmB2vbt9E9fDTjWcOcCEGSNOkMmKUJ0sZfXQ4cDbwEeD5dl4pZ40QIkqRJZ8AsTZZfAO6vqs1V9SPgc8DrgINaFw3YcQawZ2YHa9sPBB5nhrOGSZI0HxgwS5PlO8BJSZ7X+iIvBe4CbgTe0fLsPGvY1Gxi7wC+3MZ5XQuc3kbROBo4FvjakOogSdJYcRxmaYJU1S1J1gBfB7YDtwOXAtcCVyb5YEu7rO1yGfDJJBuALXQjY1BVdya5mi7Y3g6cVVVPD7UykiSNCQNmacJU1bnAuTsl38cuRrmoqqeAd05znAuACwZeQEmS5hi7ZEiSJEl9GDBLkiRJfRgwS5IkSX0YMEuSJEl9GDBLkjRCSQ5KsibJt5LcneS1SQ5Osi7Jve3nwpY3ST6UZEOSO5Ic33OcFS3/vUlWTP+OkvaUAbMkSaN1CfClqnoF8CrgbuBs4IaqOha4oa0DvJluXPRjgVXARwGSHEw3Os6JdCPinDsVZEvadwbMkiSNSJIDgdfTxkavqh9W1RN0U9yvbtlWA29vy8uBK6pzM90snocBJwPrqmpLVW0F1gGnDLEq0kSbUcCc5DeT3Jnkm0k+k+S5SY5Ocku7LXRVkv1b3gPa+oa2fXHPcc5p6fckOXl2qiRJ0pxxNLAZ+HiS25N8LMnzgUOr6pGW51Hg0LZ8OPBQz/4bW9p06ZIGYLcTlyQ5HHgvcFxV/VOb/et04FTg4qq6MsmfAivpbg2tBLZW1TFJTgcuAn4pyXFtv1cCLwH+KsnLnD1MkjSPLQCOB97TZuq8hB93vwCgqipJDeLNkqyi68rBUUcdNYhDasIsPvvaURdhLM20S8YC4CeTLACeBzwCvBFY07bvfLto6jbSGmBpkrT0K6vqB1V1P7CBXcw8JknSPLIR2FhVt7T1NXQB9GOtqwXt56a2/WHgyJ79j2hp06XvoKouraolVbVk0aJFA62INMl2GzBX1cPAHwLfoQuUtwG3AU9U1faWrffWzzO3hdr2bcCLmeHtoiSrkqxPsn7z5s17UydJkuaEqnoUeCjJy1vSUuAuYC0wNdLFCuCatrwWOKONlnESsK113bgeWJZkYXvYb1lLkzQAM+mSsZDu6vDRwBPAZ5nFBwmq6lLgUoAlS5YM5BaUJElj7D3Ap9qzQPcBZ9Jd0Lo6yUrgQeC0lvc6ui6RG4AnW16qakuS84FbW77zqmrL8KogTbbdBszALwD3V9VmgCSfA15H92TugnYVuffWz9RtoY2tC8eBwOPM8HaRJEnzSVV9A1iyi01Ld5G3gLOmOc7lwOWDLZ0kmFkf5u8AJyV5XuuLPHW76EbgHS3PzreLpm4jvQP4cmvga4HT2ygaR9ONIfm1wVRDkiRJmh27vcLcntpdA3wd2A7cTtdl4lrgyiQfbGmXtV0uAz6ZZAOwhW5kDKrqzjbCxl3tOGc5QoYkSZLG3Uy6ZFBV59LNINTrPnYxykVVPQW8c5rjXABcsIdllCRJkkbGmf4kSZKkPgyYJUmSpD4MmCVJkqQ+DJglSZKkPgyYJUmSpD4MmCVJkqQ+DJglSZKkPgyYJUmSpD4MmCVJkqQ+DJglSZKkPgyYJUmSpD4MmCVJGqEkDyT5uyTfSLK+pR2cZF2Se9vPhS09ST6UZEOSO5Ic33OcFS3/vUlWjKo+0iQyYJYkafT+bVW9uqqWtPWzgRuq6ljghrYO8Gbg2PZaBXwUugAbOBc4ETgBOHcqyJa07wyYpQmT5KAka5J8K8ndSV7r1SppzlkOrG7Lq4G396RfUZ2bgYOSHAacDKyrqi1VtRVYB5wy7EJLk8qAWZo8lwBfqqpXAK8C7sarVdI4K+Avk9yWZFVLO7SqHmnLjwKHtuXDgYd69t3Y0qZLlzQABszSBElyIPB64DKAqvphVT2BV6ukcfavq+p4ui+wZyV5fe/Gqiq6oHqfJVmVZH2S9Zs3bx7EIaV5wYBZmixHA5uBjye5PcnHkjyfWbxa5T9gad9U1cPt5ybg83R3dR5rX15pPze17A8DR/bsfkRLmy595/e6tKqWVNWSRYsWDboq0sQyYJYmywLgeOCjVfUa4Pv8uPsFMNirVe14/gOW9lKS5yd54dQysAz4JrAWmHp2YAVwTVteC5zRnj84CdjWvgxfDyxLsrB1n1rW0iQNwIJRF0DSQG0ENlbVLW19DV3A/FiSw6rqkT24WvWGndJvmsVyS/PVocDnk0D3P/nTVfWlJLcCVydZCTwInNbyXwecCmwAngTOBKiqLUnOB25t+c6rqi3Dq4Y02QyYpQlSVY8meSjJy6vqHmApcFd7rQAu5NlXq34jyZV0D/hta0H19cD/7HnQbxlwzjDrIs0HVXUf3cO5O6c/Ttd+d04v4KxpjnU5cPmgyyjJgFmaRO8BPpVkf+A+uitQP4FXqyRJ2isGzNKEqapvAEt2scmrVZIk7QUf+pMkSZL6MGCWJEmS+jBgliRJkvqYUcCc5KAka5J8K8ndSV6b5OAk65Lc234ubHmT5ENJNiS5I8nxPcdZ0fLfm2TF9O8oSZIkjYeZXmG+BPhSVb2Cbvibu+nGdr2hqo4FbuDHkyO8GTi2vVYBHwVIcjBwLt3QVScA5/YMWSVJkiSNpd0GzEkOBF4PXAZQVT+sqieA5cDqlm018Pa2vBy4ojo3Awe1iRJOBtZV1Zaq2gqsA04ZaG0kSZKkAZvJFeajgc3Ax5PcnuRjbfrOQ9t0nACP0s1WBHA48FDP/htb2nTpO0iyKsn6JOs3b968Z7WRJEmSBmwmAfMC4Hjgo1X1GuD7/Lj7BfDMWK41iAJV1aVVtaSqlixatGgQh5QkSZL22kwC5o3Axqq6pa2voQugH2tdLWg/N7XtDwNH9ux/REubLl2SJEkaW7sNmKvqUeChJC9vSUuBu4C1wNRIFyuAa9ryWuCMNlrGScC21nXjemBZkoXtYb9lLU2SJEkaWzOdGvs9wKeS7A/cB5xJF2xfnWQl8CBwWst7HXAqsAF4suWlqrYkOR+4teU7r6q2DKQWkiRJ0iyZUcBcVd8Aluxi09Jd5C3grGmOczlw+Z4UUJIkSRolZ/qTJGmEkuzXRqH6Qls/OsktbQKwq9rdXZIc0NY3tO2Le45xTku/J8nJo6mJNLkMmCVJGq330U0INuUi4OKqOgbYCqxs6SuBrS394paPJMcBpwOvpJvf4CNJ9htS2aV5wYBZkqQRSXIE8BbgY209wBvpRqSCZ08MNjVh2Bpgacu/HLiyqn5QVffTPUN0wnBqIM0PBsySJI3OHwO/A/xzW38x8ERVbW/rvZN8PTMBWNu+reWf0cRgkvaeAbMkSSOQ5K3Apqq6bYjv6Wy60l4wYJYkaTReB7wtyQPAlXRdMS4BDkoyNYpV7yRfz0wA1rYfCDzOHkwM5my60t4xYJYkaQSq6pyqOqKqFtM9tPflqvpl4EbgHS3bzhODTU0Y9o6Wv1r66W0UjaOBY4GvDaka0rww04lLJEnScHwAuDLJB4Hbgcta+mXAJ5NsALbQBdlU1Z1JrqabhXc7cFZVPT38YkuTy4BZkqQRq6qbgJva8n3sYpSLqnoKeOc0+18AXDB7JZTmN7tkSJIkSX0YMEuSJEl9GDBLkiRJfRgwS5IkSX0YMEuSJEl9GDBLkiRJfRgwS5IkSX0YMEuSJEl9GDBLEyjJfkluT/KFtn50kluSbEhyVZL9W/oBbX1D27645xjntPR7kpw8mppIkjR6BszSZHofcHfP+kXAxVV1DLAVWNnSVwJbW/rFLR9JjqObdveVwCnAR5LsN6SyS5I0VgyYpQmT5AjgLcDH2nqANwJrWpbVwNvb8vK2Ttu+tOVfDlxZVT+oqvuBDexiql5JkuYDA2Zp8vwx8DvAP7f1FwNPVNX2tr4ROLwtHw48BNC2b2v5n0nfxT47SLIqyfok6zdv3jzIekiSNBYMmKUJkuStwKaqum1Y71lVl1bVkqpasmjRomG9rSRJQ7Ng1AWQNFCvA96W5FTgucCLgEuAg5IsaFeRjwAebvkfBo4ENiZZABwIPN6TPqV3H0mS5hUDZmkfLT772oEc54EL37LPx6iqc4BzAJK8AfgvVfXLST4LvAO4ElgBXNN2WdvW/6Zt/3JVVZK1wKeT/BHwEuBY4Gv7XEBJO0jyXOArwAF0/5PXVNW5SY6ma68vBm4DfrWqfpjkAOAK4Ofpvtz+UlU90I51Dt2DvE8D762q64ddH2lSzbhLhsNUSXPaB4DfSrKB7h/wZS39MuDFLf23gLMBqupO4GrgLuBLwFlV9fTQSy1Nvh8Ab6yqVwGvBk5JchKObCONlT3pw+wwVdIcUlU3VdVb2/J9VXVCVR1TVe+sqh+09Kfa+jFt+309+19QVT9TVS+vqi+Oqh7SJKvO99rqc9qrcGQbaazMKGB2mCpJkmZHu4P7DWATsA74NrM4so2kPTfTK8xDHaZKkqT5oqqerqpX0z1cewLwitl6L4eBlPbObgPmYQ9TZWOWJM1HVfUEcCPwWtrINm3Trka2YW9GtnEYSGnvzOQK89QwVQ/QPbH7RnqGqWp5bMySJO2hJIuSHNSWfxJ4E93zQjfSjVwDux7ZBnpGtmnpp7cH74/GkW2kgdrtsHIOUyVJ2heDGnpxQh0GrG4Pwf8EcHVVfSHJXcCVST4I3M6OI9t8so1ss4XuYXqq6s4kUyPbbMeRbaSB2pdxmD+AjVmSpL1WVXcAr9lF+n3s4sH4qnoKeOc0x7oAuGDQZZS0hwFzVd0E3NSWbcySJEmaeHsyDrMkSZI07xgwS5IkSX0YMEuSJEl9GDBLkiRJfezLKBmSJM05gxrm7oEL3zKQ40gaf15hliRJkvowYJYkSZL6MGCWJEmS+jBgliRJkvowYJYkSZL6MGCWJEmS+jBgliRJkvowYJYkSZL6MGCWJGlEkhyZ5MYkdyW5M8n7WvrBSdYlubf9XNjSk+RDSTYkuSPJ8T3HWtHy35tkxajqJE0iA2ZJkkZnO/D+qjoOOAk4K8lxwNnADVV1LHBDWwd4M3Bse60CPgpdgA2cC5wInACcOxVkS9p3BsySJI1IVT1SVV9vy98F7gYOB5YDq1u21cDb2/Jy4Irq3AwclOQw4GRgXVVtqaqtwDrglCFWRZpoBsySJI2BJIuB1wC3AIdW1SNt06PAoW35cOChnt02trTp0iUNgAGzJEkjluQFwJ8D/7mq/rF3W1UVUAN6n1VJ1idZv3nz5kEcUpoXDJglSRqhJM+hC5Y/VVWfa8mPta4WtJ+bWvrDwJE9ux/R0qZL30FVXVpVS6pqyaJFiwZbEWmCGTBLkjQiSQJcBtxdVX/Us2ktMDXSxQrgmp70M9poGScB21rXjeuBZUkWtof9lrU0SQOwYNQFkCRpHnsd8KvA3yX5Rkv7XeBC4OokK4EHgdPatuuAU4ENwJPAmQBVtSXJ+cCtLd95VbVlOFWQJp8BszRBkhwJXEH3gFABl1bVJW3IqauAxcADwGlVtbVd3bqE7h/wk8C7p57Yb+O4/l479AerajWSBqqqvgpkms1Ld5G/gLOmOdblwOWDK52kKXbJkCaLY7pKkjRgBszSBHFMV0mSBs+AWZpQjukqSdJg7DZgdp57ae4Z1piu7b0c11WSNNFmcoXZPpHSHDLMMV3BcV0lSZNvtwGzfSKlucMxXSVJGrw9GlbOPpEaF4vPvnbURRhXjukqSfOQ/xdn14wD5p37RHYXsjpVVUkGNs89XVcOjjrqqEEcUpo3HNNVkqTBm9EoGc5zL0mSpPlqJqNk2CdSkiRJ89ZMumTYJ1KSJEnz1m4DZvtESpIkaT5zpj9JkiSpDwNmSZIkqQ8DZkmSRiTJ5Uk2JflmT9rBSdYlubf9XNjSk+RDSTYkuSPJ8T37rGj5702yYlfvJWnvGTBLkjQ6n+DZs96eDdxQVccCN7R1gDcDx7bXKuCj0AXYwLnAicAJwLlTQbakwTBgliRpRKrqK8DOI0YtB1a35dXA23vSr6jOzcBBbR6Ek4F1VbWlqrYC63h2EC5pHxgwS5I0Xg5t8xcAPAoc2pYPBx7qybexpU2XLmlADJglSRpTbajWGtTxkqxKsj7J+s2bNw/qsNLEM2CWJGm8PNa6WtB+bmrpDwNH9uQ7oqVNl/4sVXVpVS2pqiWLFi0aeMGlSWXALEnSeFkLTI10sQK4pif9jDZaxknAttZ143pgWZKF7WG/ZS1N0oDMZGpsSZI0C5J8BngDcEiSjXSjXVwIXJ1kJfAgcFrLfh1wKrABeBI4E6CqtiQ5H7i15TuvqnZ+kFDSPjBgliRpRKrqXdNsWrqLvAWcNc1xLgcuH2DRJPWwS4YkSZLUhwGzJEmS1IcBsyRJktSHfZglSZI0lhaffe1AjvPAhW/Zp/29wixJkiT1YcAsSZIk9WGXDEnSLg3qVqgkzXUGzJIkSSPiF9O5wS4ZkiRJUh8GzJIkSVIfBsySJElSH/Zh1lDZV0uSJM01BsyaEQNdae6wvWrcjMvkE1NsI9pTBsySNCb8Jy71ZxvRqAw9YE5yCnAJsB/wsaq6cNhlkDQztteZ8Z+4xoHtVZo9Qw2Yk+wHfBh4E7ARuDXJ2qq6a5jlmE/8R669NR/aq+1Dk2I+tFdplIZ9hfkEYENV3QeQ5EpgOWCDlsbPWLdXg11pB7PSXm1nUmfYAfPhwEM96xuBE4dchjnBk5TGwKy0V/+2pVnh/1dpFo3dQ39JVgGr2ur3ktwzyvKMwCHAP4y6ECM0b+ufi2ZU95cOoyx7wjY7f/9mm3lb/1wE7L7+Y9VmJ6S9zuW/Ocs+fIcA/9Da6+5M216HHTA/DBzZs35ES3tGVV0KXDrMQo2TJOurasmoyzEq87n+Y1j33bZXsM2O4e9tqKz/2NR/3rTXMfrM95hlH75BlXvYM/3dChyb5Ogk+wOnA2uHXAZJM2N7leYO26s0i4Z6hbmqtif5DeB6umFvLq+qO4dZBkkzY3uV5g7bqzS7ht6HuaquA64b9vvOIXP6VtkAzOf6j13dba8zMna/tyGz/mNiHrXXsfnM94JlH76BlDtVNYjjSJIkSRNp2H2YJUmSpDnFgHlEkpyS5J4kG5KcPU2e05LcleTOJJ8edhln0+7qn+SoJDcmuT3JHUlOHUU5Z0OSy5NsSvLNabYnyYfaZ3NHkuOHXUY920zabMv3i0kqyZx7mrwfz1nz95w1KjP4zH+r/b3dkeSGJGMzhN9cPV/M5XY+6220qnwN+UX3QMa3gZ8G9gf+FjhupzzHArcDC9v6T4263EOu/6XAr7fl44AHRl3uAdb/9cDxwDen2X4q8EUgwEnALaMu83x/zeRvtuV7IfAV4GZgyajLPcz6e86a3HPWGH/m/xZ4Xlv+deCqUZd7pmVv+cbqfDGX2/kw2qhXmEfjmSlMq+qHwNQUpr3+E/DhqtoKUFWbhlzG2TST+hfworZ8IPD3QyzfrKqqrwBb+mRZDlxRnZuBg5IcNpzSaRoz+ZsFOB+4CHhqmIUbAs9Z8/icNSK7/cyr6saqerKt3kw39vQ4mKvni7nczme9jRowj8aupjA9fKc8LwNeluT/Jrk5ySlDK93sm0n9fx/4lSQb6Z76fs9wijYWZvL5aLh2+ztpXWeOrKpJnPvbc5bnrGHb0/PgSro7c+Ngrp4v5nI7n/U2asA8vhbQ3fp4A/Au4M+SHDTSEg3Xu4BPVNURdF0UPpnEv1eNpfa3+UfA+0ddlhHynOU5aySS/AqwBPiDUZdlJub4+WIut/N9aqM25tGYyRSmG4G1VfWjqrof+H90f6STYCb1XwlcDVBVfwM8l24++PlgRlPcaqh29zt5IfBzwE1JHqDre752XB7kGQDPWZ6zhm1G58EkvwD8V+BtVfWDIZVtd+bq+WIut/NZb6MGzKMxkylM/4LuGxxJDqG7DXLfMAs5i2ZS/+8ASwGS/CzdH/bmoZZydNYCZ7TRMk4CtlXVI6Mu1DzX92+2qrZV1SFVtbiqFtP1p3xbVa0fTXEHznOW56xh2+1nnuQ1wP+ma2vj0pcW5u75Yi6381lvo0Of6U/TT2Ga5DxgfVWtbduWJbkLeBr47ap6fHSlHpwZ1v/9dLd6fpOuo/67qz3aOtcl+QzdCeeQ1pfqXOA5AFX1p3R9q04FNgBPAmeOpqSaMsO/2YnlOWt+n7NGYYaf+R8ALwA+mwTgO1X1tpEVupmr54u53M6H0Uad6U+SJEnqwy4ZkiRJUh8GzJIkSVIfBsySJElSHwbMkiRJUh8GzJIkSVIfBsySJElSHwbMkiRJUh8GzJIkSVIf/x8RDypG7eWxsQAAAABJRU5ErkJggg==
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cuda&#39;</span><span class="p">:</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">FloatTensor</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span>
<span class="c1"># if cloud</span>
<span class="c1"># dtype = torch.cuda.FloatTensor</span>
<span class="n">PLOT</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
<span class="n">skin_sample_ch0</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">skin_sample_ch0_np</span><span class="p">))</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
<span class="n">skin_sample_ch1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">skin_sample_ch1_np</span><span class="p">))</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
<span class="n">skin_sample_ch2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">skin_sample_ch2_np</span><span class="p">))</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">closure</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">i</span>
    <span class="n">images_all</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">if</span> <span class="n">param_noise</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">parameters</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">())</span> <span class="o">==</span> <span class="mi">4</span><span class="p">]:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="n">n</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">normal_</span><span class="p">()</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">/</span> <span class="mi">50</span>
    
    <span class="n">net_input</span> <span class="o">=</span> <span class="n">net_input_saved</span>
    <span class="k">if</span> <span class="n">reg_noise_std</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">net_input</span> <span class="o">=</span> <span class="n">net_input_saved</span> <span class="o">+</span> <span class="p">(</span><span class="n">noise</span><span class="o">.</span><span class="n">normal_</span><span class="p">()</span> <span class="o">*</span> <span class="n">reg_noise_std</span><span class="p">)</span>
        
    <span class="n">out</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">net_input</span><span class="p">)</span>
    
    <span class="c1"># ussing KL per channel</span>
    <span class="n">mask_skin</span> <span class="o">=</span> <span class="n">mask_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">mask_lesion</span> <span class="o">=</span> <span class="o">-</span><span class="n">mask_skin</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">out_ch</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">lesion_only_ch0</span> <span class="o">=</span>  <span class="n">out_ch</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">out_ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">mask_lesion</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)]</span>
    <span class="n">lesion_only_ch1</span> <span class="o">=</span>  <span class="n">out_ch</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">out_ch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">mask_lesion</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)]</span>
    <span class="n">lesion_only_ch2</span> <span class="o">=</span>  <span class="n">out_ch</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">out_ch</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">mask_lesion</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)]</span>
    <span class="n">kl_loss_ch0</span> <span class="o">=</span> <span class="n">KL</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">lesion_only_ch0</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">skin_sample_ch0</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">kl_loss_ch1</span> <span class="o">=</span> <span class="n">KL</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">lesion_only_ch1</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">skin_sample_ch1</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">kl_loss_ch2</span> <span class="o">=</span> <span class="n">KL</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">lesion_only_ch2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">skin_sample_ch2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    
    <span class="n">total_loss</span> <span class="o">=</span> <span class="n">mse</span><span class="p">(</span><span class="n">out</span> <span class="o">*</span> <span class="n">mask_var</span><span class="p">,</span> <span class="n">img_var</span> <span class="o">*</span> <span class="n">mask_var</span><span class="p">)</span> <span class="o">+</span> <span class="n">kl_loss_ch0</span> <span class="o">+</span> <span class="n">kl_loss_ch2</span> <span class="o">+</span> <span class="n">kl_loss_ch2</span>
    <span class="n">total_loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Iteration </span><span class="si">%05d</span><span class="s1">    Loss </span><span class="si">%.12f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">total_loss</span><span class="o">.</span><span class="n">item</span><span class="p">()),</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    
    <span class="k">if</span>  <span class="n">PLOT</span><span class="p">:</span>
        <span class="n">out_np</span> <span class="o">=</span> <span class="n">torch_to_np</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">image_to_save</span> <span class="o">=</span> <span class="n">out_np</span>
        <span class="n">images_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_to_save</span><span class="p">)</span>
        
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>    

    <span class="k">return</span> <span class="n">total_loss</span><span class="p">,</span> <span class="n">images_all</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pad</span> <span class="o">=</span> <span class="s1">&#39;zero&#39;</span> 
<span class="n">OPT_OVER</span> <span class="o">=</span> <span class="s1">&#39;net&#39;</span>
<span class="n">OPTIMIZER</span> <span class="o">=</span> <span class="s1">&#39;adam&#39;</span>
<span class="n">INPUT</span> <span class="o">=</span> <span class="s1">&#39;noise&#39;</span>
<span class="n">input_depth</span> <span class="o">=</span> <span class="n">channels_input</span> 
<span class="n">num_iter</span> <span class="o">=</span> <span class="n">run_epochs</span> 
<span class="n">param_noise</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">show_every</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">reg_noise_std</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">LR</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">restart_i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">restart</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">params</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;LR=</span><span class="si">{LR}</span><span class="s1">_noise=</span><span class="si">{reg_noise_std}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mse_error_all</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">img_np</span> <span class="o">=</span> <span class="n">img</span>
<span class="n">img_mask_np</span> <span class="o">=</span> <span class="n">mask_inpain</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">while</span> <span class="n">restart</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;training initialization </span><span class="si">{restart_i}</span><span class="s1"> with LR = </span><span class="si">{LR:.12f}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">restart_i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># Loss</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">KL</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">KLDivLoss</span><span class="p">()</span>
    <span class="n">img_var</span> <span class="o">=</span> <span class="n">np_to_torch</span><span class="p">(</span><span class="n">img_np</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">mask_var</span> <span class="o">=</span> <span class="n">np_to_torch</span><span class="p">(</span><span class="n">img_mask_np</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

    <span class="n">net</span> <span class="o">=</span> <span class="n">skip</span><span class="p">(</span><span class="n">input_depth</span><span class="p">,</span> <span class="n">img_np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
            <span class="n">num_channels_down</span> <span class="o">=</span> <span class="n">channels_layers</span><span class="p">,</span> 
            <span class="n">num_channels_up</span>   <span class="o">=</span> <span class="n">channels_layers</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
            <span class="n">num_channels_skip</span> <span class="o">=</span> <span class="n">channels_skip</span><span class="p">,</span> 
            <span class="n">upsample_mode</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">filter_skip_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">filter_size_up</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filter_size_down</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
            <span class="n">need_sigmoid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">need_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span> <span class="n">act_fun</span><span class="o">=</span><span class="s1">&#39;LeakyReLU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>        
    <span class="n">net_input</span> <span class="o">=</span> <span class="n">get_noise2</span><span class="p">(</span><span class="n">input_depth</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">,</span> <span class="n">img_np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">noise_type</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">net_input_saved</span> <span class="o">=</span> <span class="n">net_input</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">net_input</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;noise: {type(noise.detach().cpu().numpy())}, {np.shape(noise.detach().cpu().numpy())}, {np.min(noise.detach().cpu().numpy()), np.mean(noise.detach().cpu().numpy()), np.max(noise.detach().cpu().numpy())}&#39;</span><span class="p">)</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">(</span><span class="n">OPT_OVER</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">net_input</span><span class="p">)</span>
    <span class="n">mse_error</span><span class="p">,</span> <span class="n">images_generated_all</span><span class="p">,</span> <span class="n">best_iter</span><span class="p">,</span> <span class="n">restart</span> <span class="o">=</span> <span class="n">optimize_melanoma_v1</span><span class="p">(</span><span class="n">OPTIMIZER</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">closure</span><span class="p">,</span> <span class="n">LR</span><span class="p">,</span> <span class="n">num_iter</span><span class="p">,</span> <span class="n">show_every</span><span class="p">,</span> <span class="n">path_img_dest</span><span class="p">,</span> <span class="n">restart</span><span class="p">,</span> <span class="n">annealing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lr_finder_flag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="n">mse_error</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mse_error</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">restart_i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># reduce lr if the network is not learning with the initializations</span>
        <span class="n">LR</span> <span class="o">/=</span> <span class="mf">1.2</span>
    <span class="k">if</span> <span class="n">restart_i</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span> <span class="c1"># if the network cannot be trained continue (might not act on for loop!!)</span>
        <span class="k">continue</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>training initialization 0 with LR = 0.010000000000
using get_noise2
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>  0%|          | 0/51 [00:00&lt;?, ?it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>noise: &lt;class &#39;numpy.ndarray&#39;&gt;, (1, 32, 512, 512), (-0.53264946, 3.0437857e-05, 0.5106273)
0
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>  2%|▏         | 1/51 [00:07&lt;06:11,  7.44s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>1
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>  4%|▍         | 2/51 [00:13&lt;05:39,  6.93s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>  6%|▌         | 3/51 [00:17&lt;04:55,  6.16s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>3
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>  8%|▊         | 4/51 [00:22&lt;04:25,  5.65s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>4
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 10%|▉         | 5/51 [00:26&lt;04:00,  5.24s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>5
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 12%|█▏        | 6/51 [00:30&lt;03:39,  4.87s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>6
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 14%|█▎        | 7/51 [00:34&lt;03:25,  4.67s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>7
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 16%|█▌        | 8/51 [00:38&lt;03:12,  4.49s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>8
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 18%|█▊        | 9/51 [00:42&lt;03:04,  4.38s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>9
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 20%|█▉        | 10/51 [00:46&lt;02:54,  4.25s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>10
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 22%|██▏       | 11/51 [00:50&lt;02:46,  4.16s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>11
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 24%|██▎       | 12/51 [00:55&lt;02:55,  4.49s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>12
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 25%|██▌       | 13/51 [01:01&lt;02:59,  4.72s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>13
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 27%|██▋       | 14/51 [01:05&lt;02:47,  4.52s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>14
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 29%|██▉       | 15/51 [01:09&lt;02:37,  4.37s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>15
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 31%|███▏      | 16/51 [01:12&lt;02:24,  4.13s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>16
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 33%|███▎      | 17/51 [01:17&lt;02:24,  4.26s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>17
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 35%|███▌      | 18/51 [01:22&lt;02:29,  4.53s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>18
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 37%|███▋      | 19/51 [01:26&lt;02:19,  4.35s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>19
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 39%|███▉      | 20/51 [01:29&lt;02:07,  4.10s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>20
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 41%|████      | 21/51 [01:33&lt;01:59,  3.97s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>21
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 43%|████▎     | 22/51 [01:37&lt;01:58,  4.10s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>22
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 45%|████▌     | 23/51 [01:41&lt;01:52,  4.03s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>23
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 47%|████▋     | 24/51 [01:45&lt;01:49,  4.05s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>24
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 49%|████▉     | 25/51 [01:50&lt;01:48,  4.17s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>25
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 51%|█████     | 26/51 [01:55&lt;01:49,  4.39s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>26
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 53%|█████▎    | 27/51 [01:59&lt;01:40,  4.18s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>27
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 55%|█████▍    | 28/51 [02:02&lt;01:31,  3.96s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>28
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 57%|█████▋    | 29/51 [02:05&lt;01:23,  3.80s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>29
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 59%|█████▉    | 30/51 [02:09&lt;01:18,  3.74s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>30
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 61%|██████    | 31/51 [02:15&lt;01:29,  4.45s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>31
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 63%|██████▎   | 32/51 [02:21&lt;01:33,  4.93s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>32
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 65%|██████▍   | 33/51 [02:25&lt;01:22,  4.60s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>33
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 67%|██████▋   | 34/51 [02:30&lt;01:19,  4.69s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>34
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 69%|██████▊   | 35/51 [02:34&lt;01:10,  4.41s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>35
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 71%|███████   | 36/51 [02:37&lt;01:03,  4.22s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>36
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 73%|███████▎  | 37/51 [02:42&lt;00:58,  4.19s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>37
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 75%|███████▍  | 38/51 [02:48&lt;01:02,  4.84s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>38
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 76%|███████▋  | 39/51 [02:53&lt;00:58,  4.84s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>39
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 78%|███████▊  | 40/51 [02:57&lt;00:50,  4.59s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>40
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 80%|████████  | 41/51 [03:00&lt;00:42,  4.26s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>41
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 82%|████████▏ | 42/51 [03:04&lt;00:37,  4.20s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>42
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 84%|████████▍ | 43/51 [03:08&lt;00:32,  4.05s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>43
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 86%|████████▋ | 44/51 [03:12&lt;00:28,  4.05s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>44
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 88%|████████▊ | 45/51 [03:16&lt;00:24,  4.16s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>45
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 90%|█████████ | 46/51 [03:21&lt;00:21,  4.34s/it]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>46
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">save_epochs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="c1">#[10,20,40,80,100]</span>
<span class="n">images</span><span class="o">=</span><span class="p">[]</span>
<span class="n">images_raw</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">save_epochs</span><span class="p">:</span>
    <span class="n">img_tmp</span> <span class="o">=</span> <span class="n">images_generated_all</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">mask_lesion</span> <span class="o">+</span> <span class="n">img</span> <span class="o">*</span>  <span class="n">mask_inpain</span>
    <span class="n">img_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">img_tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="n">img_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">img_tmp</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img_tmp</span><span class="p">)</span>
    <span class="n">raw_tmp</span> <span class="o">=</span> <span class="n">images_generated_all</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">raw_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">raw_tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="n">raw_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">raw_tmp</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">images_raw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_tmp</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_inpaints_pairs</span><span class="p">(</span><span class="n">mse_error</span><span class="p">,</span> <span class="n">images_raw</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">save_epochs</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">name_for_fig</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_distributions</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">mask_var</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">image_denorm</span> <span class="o">=</span> <span class="p">[</span><span class="n">denormalizePatches</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">images</span><span class="p">]</span>
<span class="n">image_raw_denorm</span> <span class="o">=</span> <span class="p">[</span><span class="n">denormalizePatches</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">images_raw</span><span class="p">]</span>
<span class="k">for</span> <span class="p">(</span><span class="n">img_to_save</span><span class="p">,</span> <span class="n">epoch_to_save</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">image_denorm</span><span class="p">,</span> <span class="n">save_epochs</span><span class="p">):</span>
    <span class="n">im2save</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img_to_save</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
    <span class="n">im2save</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{path_img_dest}</span><span class="s1">final/</span><span class="si">{filename}</span><span class="s1">_</span><span class="si">{name}</span><span class="s1">_</span><span class="si">{epoch_to_save:04d}</span><span class="s1">.png&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">img_to_save</span><span class="p">,</span> <span class="n">epoch_to_save</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">image_raw_denorm</span><span class="p">,</span> <span class="n">save_epochs</span><span class="p">):</span>
    <span class="n">im2save</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img_to_save</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
    <span class="n">im2save</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{path_img_dest}</span><span class="s1">raw/</span><span class="si">{filename}</span><span class="s1">_</span><span class="si">{name}</span><span class="s1">_</span><span class="si">{epoch_to_save:04d}</span><span class="s1">.png&#39;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{path_img_dest}</span><span class="s1">mse/</span><span class="si">{filename}</span><span class="s1">_</span><span class="si">{name}</span><span class="s1">.npy&#39;</span><span class="p">,</span> <span class="n">mse_error</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

